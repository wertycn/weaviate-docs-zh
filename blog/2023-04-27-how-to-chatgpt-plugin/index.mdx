---
authors:
- shukri
- zain
date: 2023-04-27
description: A show-and-tell of how we created the Weaviate Retrieval Plugin for ChatGPT
image: ./img/hero.png
slug: how-to-chatgpt-plugin
tags:
- how-to
- integrations
title: How to Create Your Own ChatGPT Plugin
---

![å¦‚ä½•åˆ›å»ºChatGPTæ’ä»¶](./img/hero.png)

<!-- æˆªæ–­ -->

## ç®€ä»‹

åœ¨æˆ‘ä»¬å…³äº[ChatGPTæ’ä»¶](/blog/weaviate-retrieval-plugin)çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†æ’ä»¶çš„æ½œåŠ›ï¼Œå¯ä»¥é€šè¿‡å…è®¸ChatGPTåˆ©ç”¨ç¬¬ä¸‰æ–¹èµ„æºæ¥å¤„ç†ä¸å…¶å¯¹è¯ï¼Œä»è€Œæ‰©å±•ChatGPTçš„åŠŸèƒ½ã€‚è¿™äº›æ’ä»¶çš„ä»·å€¼åœ¨äºå®ƒä»¬å¸®åŠ©å¼¥è¡¥ChatGPTç›®å‰å­˜åœ¨çš„ä¸è¶³ã€‚ä¾‹å¦‚ï¼ŒChatGPTæ˜¯å»ºç«‹åœ¨GPT 4.0ä¹‹ä¸Šçš„ä¸€ä¸ªå¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå®ƒå¯¹æ•°å­¦å’Œä»£æ•°æ¨ç†çš„ç†è§£ä¸å¦‚å¯¹ä¹¦é¢è¯­è¨€çš„ç†è§£ï¼Œå› æ­¤åœ¨éœ€è¦è§£å†³æ•°å­¦é—®é¢˜æ—¶ï¼Œä½¿ç”¨WolframAlphaæ’ä»¶ä½œä¸ºâ€œæ•°å­¦æ¨¡å¼â€æ˜¯å®Œå…¨åˆç†çš„ï¼

æˆ‘ä»¬è®¨è®ºè¿‡çš„ChatGPTçš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œé™¤éè¯¥ä¸Šä¸‹æ–‡æ˜ç¡®ä¼ è¾¾åœ¨æç¤ºçš„å†…å®¹ä¸­ï¼Œå¦åˆ™å®ƒåœ¨å›ç­”é—®é¢˜æ—¶ä¸ä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯[ChatGPTæ£€ç´¢æ’ä»¶](https://github.com/openai/chatgpt-retrieval-plugin)ï¼Œå®ƒå°†ChatGPTè¿æ¥åˆ°ä¸€ä¸ªå‘é‡æ•°æ®åº“ï¼Œä¸ºä¸Šè¿°é—®é¢˜æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆã€‚ä¸ChatGPTè¿æ¥çš„å‘é‡æ•°æ®åº“å¯ä»¥ç”¨äºå­˜å‚¨å’Œå¼•ç”¨ç›¸å…³ä¿¡æ¯ï¼Œåœ¨å›ç­”æç¤ºæ—¶å……å½“LLMçš„é•¿æœŸè®°å¿†ã€‚

æ’ä»¶æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„æ–¹å¼ï¼Œæ‚¨å’Œæˆ‘å¯ä»¥é€šè¿‡æ’ä»¶æ¥æ”¹è¿›LLMçš„ç”¨ä¾‹ï¼Œè€Œæ— éœ€é‡æ–°è®­ç»ƒåŸºç¡€çš„GPTæ¨¡å‹ã€‚å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨ChatGPTï¼Œå¹¶æ„è¯†åˆ°å½“æ‚¨è¯¢é—®æœ‰å…³å¤©æ°”çš„é—®é¢˜æ—¶ï¼Œå®ƒçš„å¯¹è¯èƒ½åŠ›ä¸å¤Ÿå¥½ï¼Œæˆ–è€…å®ƒå¯¹æ‚¨çš„å¥åº·æƒ…å†µæ²¡æœ‰è¶³å¤Ÿä¸“ä¸šçš„ç†è§£ï¼Œæ— æ³•æ ¹æ®æ‚¨ä¹‹å‰çš„è¡€ç³–ã€è¡€å‹æ°´å¹³å’Œå¥åº·çŠ¶å†µä¸ºæ‚¨æä¾›ç¾å‘³åˆå¥åº·çš„é£Ÿè°±å»ºè®®ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ’ä»¶æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œå¹¶é€šè¿‡è¿™æ ·åšæ¥æé«˜æ‰€æœ‰äººçš„å¯ç”¨æ€§ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥ç®€å•åœ°å®‰è£…æ‚¨çš„æ’ä»¶å¹¶ä½¿ç”¨å®ƒï¼

é‚£ä¹ˆå”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œ**æ‚¨å¦‚ä½•è·å¾—OpenAIè¿è¡Œçš„ç‹¬å®¶æ’ä»¶alphaçš„è®¿é—®æƒé™**ï¼Œä»¥åŠ**æ‚¨å¦‚ä½•åˆ›å»ºChatGPTçš„æ’ä»¶ï¼** ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å¸¦æ¥äº†ä¸¤ä¸ªå¥½æ¶ˆæ¯ğŸ˜€ã€‚

Weaviateæ­£åœ¨ä¸OpenAIå’ŒCortical Venturesåˆä½œï¼Œåœ¨5æœˆ11æ—¥åœ¨æ³¢å£«é¡¿çš„Hynesä¼šè®®ä¸­å¿ƒä¸¾åŠä¸ºæœŸä¸€å¤©çš„[ODSC Eastç”Ÿæˆå¼AIé»‘å®¢é©¬æ‹‰æ¾æ´»åŠ¨](https://www.eventbrite.com/e/generative-ai-hackathon-odsc-east-2023-tickets-616336738777)ã€‚åœ¨é‚£é‡Œï¼Œæ‚¨å°†è·å¾—OpenAIæä¾›çš„**OpenAI API**å’Œ**ChatGPTæ’ä»¶ä»¤ç‰Œ**çš„è®¿é—®æƒé™ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ChatGPTå’ŒWeaviateç­‰å·¥å…·åˆ›å»ºè‡ªå·±çš„æ’ä»¶ä»¥åŠç±»ä¼¼AutoGPTçš„åº”ç”¨ç¨‹åºï¼Œè§£å†³æ‚¨å…³å¿ƒçš„é—®é¢˜ï¼æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šé¢æä¾›çš„é“¾æ¥è¿›è¡Œæ³¨å†Œï¼Œåé¢æœ‰é™ï¼Œè¯·å°½å¿«æ³¨å†Œï¼

![hackathon](./img/hackathon.png)

ç°åœ¨å¼€å§‹ä»‹ç»å¦‚ä½•ä¸ºChatGPTåˆ›å»ºè‡ªå·±çš„æ’ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†é€æ­¥ä»‹ç»åˆ›å»ºWeaviateæ£€ç´¢æ’ä»¶çš„è¿‡ç¨‹ã€‚Weaviateæ£€ç´¢æ’ä»¶å°†ChatGPTä¸Weaviateå®ä¾‹è¿æ¥èµ·æ¥ï¼Œå…è®¸å…¶ä»å‘é‡æ•°æ®åº“ä¸­æŸ¥è¯¢ç›¸å…³æ–‡æ¡£ï¼Œæ›´æ–°æ–‡æ¡£ä»¥ä¾¿ä»¥åâ€œè®°ä½â€ä¿¡æ¯ï¼Œä»¥åŠåˆ é™¤æ–‡æ¡£ä»¥â€œå¿˜è®°â€å®ƒä»¬ï¼åˆ›å»ºæ­¤æ’ä»¶çš„è¿‡ç¨‹ä¸åˆ›å»ºé€šç”¨æ’ä»¶çš„è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬è®¤ä¸ºè¿™å¯¹äºç†è§£æ’ä»¶çš„åˆ›å»ºè¿‡ç¨‹éå¸¸æœ‰å¸®åŠ©ï¼Œå¸Œæœ›èƒ½å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼

## å¦‚ä½•åˆ›å»ºChatGPTæ’ä»¶

![plugin](./img/plugin-light.png#gh-light-mode-only)
![plugin](./img/plugin-dark.png#gh-dark-mode-only)

å®Œæ•´çš„Weaviateæ£€ç´¢æ’ä»¶çš„ä»£ç å­˜å‚¨åº“ä½äº[è¿™é‡Œ](https://github.com/weaviate/howto-weaviate-retrieval-plugin)ã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°ä»‹ç»ï¼ŒåŒ…æ‹¬ä»£ç ç‰‡æ®µã€æˆ‘ä»¬é‡åˆ°çš„ä¸€äº›æŒ‘æˆ˜ä»¥åŠæˆ‘ä»¬æœ€ç»ˆæ˜¯å¦‚ä½•è§£å†³å®ƒä»¬çš„ã€‚

æˆ‘ä»¬ç”¨äºå¼€å‘æ­¤æ’ä»¶çš„æŠ€æœ¯æ ˆå¦‚ä¸‹ï¼š
1. Pythonï¼šä½¿ç”¨Pythonç¼–å†™æ‰€æœ‰å†…å®¹
2. FastAPIï¼šç”¨äºè¿è¡Œæ’ä»¶çš„æœåŠ¡å™¨
3. Pytestï¼šç”¨äºç¼–å†™å’Œè¿è¡Œæµ‹è¯•
4. Dockerï¼šæˆ‘ä»¬åˆ›å»ºå®¹å™¨æ¥æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²æ’ä»¶

ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¼€å‘æ’ä»¶æ‰€é‡‡å–çš„æ­¥éª¤ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸“æ³¨äºæ„å»ºå…·æœ‰æ‰€éœ€ç«¯ç‚¹çš„Webåº”ç”¨ç¨‹åºï¼Œç¬¬äºŒéƒ¨åˆ†ä¸“é—¨é’ˆå¯¹ChatGPTæ’ä»¶çš„å¼€å‘ï¼Œè€Œç¬¬ä¸‰éƒ¨åˆ†åˆ™ä»‹ç»äº†ä½¿ç”¨Fly.ioè¿›è¡Œè¿œç¨‹éƒ¨ç½²çš„å†…å®¹ã€‚æˆ‘ä»¬æŒ‰é¡ºåºä»‹ç»è¿™äº›æ­¥éª¤ï¼Œä½†æ ¹æ®æ‚¨å¯¹ææ–™çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œå¯ä»¥éšæ„è·³è¿‡æ­¥éª¤ã€‚

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ„å»ºWebåº”ç”¨ç¨‹åº

**æ­¥éª¤1ï¼šè®¾ç½®å¼€å‘ç¯å¢ƒ**

ä¸ºäº†è®¾ç½®æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬ä½¿ç”¨äº†[Dev Containers](https://containers.dev/)ã€‚é€šè¿‡æ·»åŠ [Fly.io](https://fly.io/)ã€[Docker](https://www.docker.com/)å’Œ[Poetry](https://python-poetry.org/)ï¼Œæ›´æ–°äº†`devcontainer.json`[æ–‡ä»¶](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/.devcontainer/devcontainer.json)ã€‚æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://containers.dev/templates)æ‰¾åˆ°å…¶ä»–çš„å¼€å‘å®¹å™¨æ¨¡æ¿ã€‚

**æ­¥éª¤2. æµ‹è¯•è®¾ç½®**

1. åœ¨è®¾ç½®ç¯å¢ƒåï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯•äº†ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ï¼š
åˆ›å»ºä¸€ä¸ª[dummy endpoint](https://github.com/weaviate/howto-weaviate-retrieval-plugin/commit/57c00bc85aea3a155d330f0de72525ee26a665d1#diff-c16fbf0c6f7b90a46b94b36f88893c2d174476088608841f7254afba0e81373d)ï¼Œå½“è°ƒç”¨æ—¶å®ƒä¼šç®€å•åœ°å“åº”ä¸€ä¸ª`{"Hello": "World"}`å¯¹è±¡ã€‚

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def read_root():
    """
    Say hello to the world
    """
    return {"Hello": "World"}
```

2. ä½¿ç”¨PyTestè®¾ç½®æµ‹è¯•ï¼Œè¾¾åˆ°ä¸¤ä¸ªç›®æ ‡ - é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ£€æŸ¥æˆ‘ä»¬çš„Weaviateå®ä¾‹æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œè®¾ç½®æ–¹æ³•åœ¨[è¿™é‡Œ](https://github.com/weaviate/howto-weaviate-retrieval-plugin/commit/57c00bc85aea3a155d330f0de72525ee26a665d1#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128)ï¼Œå…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æ£€æŸ¥Fast APIç«¯ç‚¹æ˜¯å¦å“åº”ã€‚è¿™ä¸¤ä¸ªæµ‹è¯•çš„å®šä¹‰åœ¨[è¿™é‡Œ](https://github.com/weaviate/howto-weaviate-retrieval-plugin/commit/57c00bc85aea3a155d330f0de72525ee26a665d1#diff-5f4f40de92f9f92f3638fdd1c3eace62db4d153ff64b915f82e43e6781960ed6)ã€‚

3. æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª[makefile](https://github.com/weaviate/howto-weaviate-retrieval-plugin/commit/57c00bc85aea3a155d330f0de72525ee26a665d1#diff-beda42571c095172ab63437d050612a571d0d9ddd3ad4f2aecbce907a9b7e3d0)æ¥è‡ªåŠ¨åŒ–è¿è¡Œå’Œæµ‹è¯•ï¼Œå¹¶å¯åŠ¨ç«¯ç‚¹ã€‚åœ¨æˆ‘ä»¬çš„makefileä¸­ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†ä¸€ä¸ª`run`å‘½ä»¤ï¼Œå®ƒå°†åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿ç½‘ç»œè¿æ¥è®¾ç½®æ­£ç¡®ã€‚æ‚¨è¿˜å¯ä»¥è¿æ¥åˆ°ç«¯å£8000ï¼Œè¿™æ˜¯FastAPIé»˜è®¤ç›‘å¬çš„ç«¯å£ï¼Œä»¥æ£€æŸ¥è¿æ¥æ€§ã€‚

4. æœ€åä¸€æ­¥æ˜¯éªŒè¯ä¸€åˆ‡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ‚¨å¯ä»¥è®¿é—® `localhost:8000/docs`ï¼Œè¿™å°†ä¸ºæ‚¨æä¾›ç”¨äºæ‚¨çš„ç«¯ç‚¹çš„[Swagger UI](https://swagger.io/tools/swagger-ui/)ã€‚Swagger UI å…è®¸æ‚¨ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œä¸æ‚¨å®šä¹‰çš„ä»»ä½•ç«¯ç‚¹è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸”æ‰€æœ‰å†…å®¹éƒ½ä¼šå®æ—¶æ›´æ–° - å½“æˆ‘ä»¬ä»¥åæƒ³è¦æ‰‹åŠ¨è°ƒç”¨ç«¯ç‚¹ä¸æˆ‘ä»¬çš„ Weaviate å®ä¾‹è¿›è¡ŒæŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤å¯¹è±¡æ—¶ï¼Œè¿™å°†éå¸¸æ–¹ä¾¿ã€‚

![swaggerui](./img/swagger.png)
å®Œæˆä»¥ä¸Šæ­¥éª¤å¹¶ç¡®è®¤ä¸€åˆ‡éƒ½ç¬¦åˆè¦æ±‚åï¼Œæ‚¨å¯ä»¥å¼€å§‹å®ç°ç‰¹å®šæ’ä»¶çš„åŠŸèƒ½ã€‚

**ç¬¬ä¸‰æ­¥ï¼šå®ç°ä¸€ä¸ªå‡½æ•°æ¥è·å–å‘é‡åµŒå…¥**

ç”±äºæˆ‘ä»¬æ­£åœ¨å®ç°ä¸€ä¸ªå°†å‘é‡æ•°æ®åº“è¿æ¥åˆ°ChatGPTçš„æ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ç§ç”Ÿæˆå‘é‡åµŒå…¥çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æ›´æ–°æ•°æ®åº“ä¸­çš„æ–‡æ¡£æ—¶ï¼Œå¯ä»¥ç”Ÿæˆå’Œå­˜å‚¨æ–‡æ¡£çš„å‘é‡åµŒå…¥ã€‚åŒæ—¶ï¼Œå½“æŸ¥è¯¢å’Œæ‰§è¡Œå‘é‡æœç´¢æ—¶ï¼Œè¯¥å‡½æ•°ä¹Ÿå°†ç”¨äºå°†æŸ¥è¯¢å‘é‡åŒ–ã€‚è¯¥å‡½æ•°çš„å®ç°å¯åœ¨[æ­¤å¤„](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/server/embedding.py)æ‰¾åˆ°ã€‚
```python
import openai

def get_embedding(text):
    """
    Get the embedding for a given text
    """
    results = openai.Embedding.create(input=text, model="text-embedding-ada-002")

    return results["data"][0]["embedding"]
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨[`ada-002`æ¨¡å‹](https://openai.com/blog/new-and-improved-embedding-model)ï¼Œå› ä¸ºOpenAIæŒ‡å®šäº†è¿™ä¸ªç‰¹å®šçš„æ¨¡å‹ç”¨äºä»–ä»¬çš„æ¨¡æ¿æ£€ç´¢æ’ä»¶ï¼Œä½†æ˜¯ç”±äºæŸ¥è¯¢æ˜¯åœ¨å‘é‡æ•°æ®åº“ä¸­è¿›è¡Œçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ä»»ä½•å‘é‡åŒ–å™¨ã€‚

**æ­¥éª¤4ï¼šå®ç°åˆå§‹åŒ–Weaviateå®¢æˆ·ç«¯å’Œå‘é‡æ•°æ®åº“çš„å‡½æ•°**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€äº›å‡½æ•°æ¥åˆå§‹åŒ– Weaviate Python å®¢æˆ·ç«¯ï¼Œå¹¶é€šè¿‡å®¢æˆ·ç«¯åˆå§‹åŒ– Weaviate å®ä¾‹ï¼Œé€šè¿‡æ£€æŸ¥æ¨¡å¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªæ¨¡å¼ã€‚

è¯·å‚è€ƒ[è¿™é‡Œ](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/server/database.py)çš„ä»£ç å®ç°ã€‚

```python
import weaviate
import os
import logging

INDEX_NAME = "Document"

SCHEMA = {
    "class": INDEX_NAME,
    "properties": [
        {"name": "text", "dataType": ["text"]},
        {"name": "document_id", "dataType": ["string"]},
    ],
}


def get_client():
    """
    Get a client to the Weaviate server
    """
    host = os.environ.get("WEAVIATE_HOST", "http://localhost:8080")
    return weaviate.Client(host)


def init_db():
    """
    Create the schema for the database if it doesn't exist yet
    """
    client = get_client()

    if not client.schema.contains(SCHEMA):
        logging.debug("Creating schema")
        client.schema.create_class(SCHEMA)
    else:
        class_name = SCHEMA["class"]
        logging.debug(f"Schema for {class_name} already exists")
        logging.debug("Skipping schema creation")
```

**æ­¥éª¤5ï¼šåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åˆå§‹åŒ–æ•°æ®åº“å¹¶ä¸ºWeaviateå®¢æˆ·ç«¯æ·»åŠ ä¾èµ–é¡¹**

ç°åœ¨æˆ‘ä»¬éœ€è¦é›†æˆè¿™äº›å‡½æ•°çš„ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨å¯åŠ¨ChatGPTæ’ä»¶æœåŠ¡å™¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–Weaviateå®ä¾‹å’Œå®¢æˆ·ç«¯çš„è¿æ¥ã€‚æˆ‘ä»¬ä½¿ç”¨FastAPIçš„[lifespan](https://fastapi.tiangolo.com/advanced/events/#lifespan-events)åŠŸèƒ½åœ¨[ä¸»æœåŠ¡å™¨Pythonè„šæœ¬](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/server/main.py)ä¸­å®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥è„šæœ¬åœ¨æ¯æ¬¡æœåŠ¡å™¨å¯åŠ¨æ—¶è¿è¡Œã€‚è¿™ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨äº†æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„æ•°æ®åº“åˆå§‹åŒ–å‡½æ•°ï¼Œå®ƒè¿”å›Weaviateå®¢æˆ·ç«¯å¯¹è±¡ã€‚ä»»ä½•éœ€è¦åœ¨æœåŠ¡å™¨å…³é—­æ—¶è¿è¡Œçš„é€»è¾‘å¯ä»¥åœ¨ä¸‹é¢çš„`yield`è¯­å¥ä¹‹åæ·»åŠ ã€‚ç”±äºæˆ‘ä»¬çš„æ’ä»¶ä¸éœ€è¦æ‰§è¡Œä»»ä½•ç‰¹å®šçš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶ä¿ç•™ä¸ºç©ºã€‚

```python
from fastapi import FastAPI
from contextlib import asyncontextmanager

from .database import get_client, init_db

@asynccontextmanager
async def lifespan(app: FastAPI):
    init_db()
    yield


app = FastAPI(lifespan=lifespan)

def get_weaviate_client():
    """
    Get a client to the Weaviate server
    """
    yield get_client()
```

åœ¨æ­¤ä¹‹åï¼Œåˆå§‹çš„æœåŠ¡å™¨è®¾ç½®å’Œæµ‹è¯•å·²ç»å®Œæˆã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ°äº†å®ç°ç«¯ç‚¹çš„æœ‰è¶£éƒ¨åˆ†ï¼Œè¿™äº›ç«¯ç‚¹å°†ä¸ºChatGPTæä¾›ä¸æˆ‘ä»¬çš„æ’ä»¶è¿›è¡Œä¸åŒäº¤äº’æ–¹å¼çš„èƒ½åŠ›ï¼

## ç¬¬äºŒéƒ¨åˆ†ï¼šå®ç°OpenAIç‰¹å®šåŠŸèƒ½

![fun](./img/areyahavingfunmrkrabs.png)

**æ­¥éª¤1ï¼šå¼€å‘Weaviate Retrievalæ’ä»¶ç‰¹å®šçš„ç«¯ç‚¹**

æˆ‘ä»¬çš„æ’ä»¶æœ‰ä¸‰ä¸ªç‰¹å®šçš„ç«¯ç‚¹ï¼š`/upsert`ã€`/query`å’Œ`/delete`ã€‚è¿™äº›åŠŸèƒ½ä½¿ChatGPTèƒ½å¤Ÿå°†å¯¹è±¡æ·»åŠ åˆ°Weaviateå®ä¾‹ä¸­ï¼Œå¯¹Weaviateå®ä¾‹ä¸­çš„å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢å’Œæœç´¢ï¼Œä»¥åŠåœ¨éœ€è¦æ—¶åˆ é™¤å¯¹è±¡ã€‚åœ¨å¯ç”¨æ’ä»¶çš„æƒ…å†µä¸‹ä¸ChatGPTäº¤äº’æ—¶ï¼Œå¯ä»¥é€šè¿‡æç¤ºæŒ‡ç¤ºå…¶ä½¿ç”¨ç‰¹å®šçš„ç«¯ç‚¹ï¼Œä½†å®ƒä¹Ÿä¼šç‹¬ç«‹å†³å®šä½•æ—¶ä½¿ç”¨é€‚å½“çš„ç«¯ç‚¹æ¥å®Œæˆå¯¹æŸ¥è¯¢çš„å“åº”ï¼è¿™äº›ç«¯ç‚¹æ˜¯æ‰©å±•ChatGPTåŠŸèƒ½å¹¶ä½¿å…¶èƒ½å¤Ÿä¸å‘é‡æ•°æ®åº“è¿›è¡Œäº¤äº’çš„å…³é”®ã€‚

æˆ‘ä»¬é€šè¿‡æµ‹è¯•é©±åŠ¨å¼€å‘çš„æ–¹å¼å¼€å‘äº†è¿™ä¸‰ä¸ªç«¯ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å°†é¦–å…ˆå±•ç¤ºæ¯ä¸ªç«¯ç‚¹å¿…é¡»é€šè¿‡çš„æµ‹è¯•ï¼Œç„¶åå±•ç¤ºæ»¡è¶³è¿™äº›æµ‹è¯•çš„å®ç°ã€‚ä¸ºäº†å‡†å¤‡è®¾ç½®Weaviateå®ä¾‹ä»¥è¿›è¡Œè¿™äº›æµ‹è¯•ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµ‹è¯•æ•°æ®é›†æ·»åŠ äº†ä»¥ä¸‹æµ‹è¯•æ–‡æ¡£ï¼š
```python
@pytest.fixture
def documents(weaviate_client):
    docs = [
        {"text": "The lion is the king of the jungle", "document_id": "1"},
        {"text": "The lion is a carnivore", "document_id": "2"},
        {"text": "The lion is a large animal", "document_id": "3"},
        {"text": "The capital of France is Paris", "document_id": "4"},
        {"text": "The capital of Germany is Berlin", "document_id": "5"},
    ]

    for doc in docs:
        client.post("/upsert", json=doc)
```

**å®ç°`/upsert`ç«¯ç‚¹ï¼š**

åœ¨ä½¿ç”¨`/upsert`ç«¯ç‚¹ä¹‹åï¼Œæˆ‘ä»¬ä¸»è¦æƒ³è¦æµ‹è¯•æ˜¯å¦è·å¾—äº†é€‚å½“çš„çŠ¶æ€ç ï¼ŒåŒæ—¶æ£€æŸ¥å†…å®¹ã€idå’Œå‘é‡æ˜¯å¦éƒ½è¢«æ­£ç¡®åœ°æ’å…¥äº†ã€‚

ä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„æµ‹è¯•ä»£ç ï¼š

```python
def test_upsert(weaviate_client):
    response = client.post("/upsert", json={"text": "Hello World", "document_id": "1"})
    assert response.status_code == 200

    docs = weaviate_client.data_object.get(with_vector=True)["objects"]
    assert len(docs) == 1
    assert docs[0]["properties"]["text"] == "Hello World"
    assert docs[0]["properties"]["document_id"] == "1"
    assert docs[0]["vector"] is not None
```

ä¸‹é¢çš„å®ç°æ»¡è¶³äº†æ‰€æœ‰è¿™äº›è¦æ±‚å’Œä¸Šé¢çš„æµ‹è¯•ï¼š
```python
@app.post("/upsert")
def upsert(doc: Document, client=Depends(get_weaviate_client)):
    """
    Insert a document into weaviate
    """
    with client.batch as batch:
        batch.add_data_object(
            data_object=doc.dict(),
            class_name=INDEX_NAME,
            vector=get_embedding(doc.text),
        )

    return {"status": "ok"}
```

`/query` å’Œ `/delete` ç«¯ç‚¹çš„å¼€å‘æ–¹å¼ç±»ä¼¼ï¼Œå¦‚æœæ‚¨æ„Ÿå…´è¶£å¯ä»¥é˜…è¯»ä¸‹é¢çš„å†…å®¹ï¼

<details>
  <summary>æŸ¥çœ‹ /query ç«¯ç‚¹å®ç°çš„è¯¦ç»†ä¿¡æ¯ã€‚</summary>

**å®ç° `/query` ç«¯ç‚¹ï¼š**

å¯¹äºè¿™ä¸ªç«¯ç‚¹ï¼Œæˆ‘ä»¬ä¸»è¦æƒ³æ£€æŸ¥å®ƒæ˜¯å¦è¿”å›äº†æ­£ç¡®æ•°é‡çš„å¯¹è±¡ï¼Œå¹¶ä¸”æˆ‘ä»¬æœŸæœ›çš„å¿…éœ€æ–‡æ¡£æ˜¯å¦åŒ…å«åœ¨è¿”å›çš„å¯¹è±¡ä¸­ã€‚

```python
def test_query(documents):
    LIMIT = 3
    response = client.post("/query", json={"text": "lion", "limit": LIMIT})

    results = response.json()

    assert len(results) == LIMIT
    for result in results:
        assert "lion" in result["document"]["text"]
```

ä¸‹é¢çš„å®ç°å°†æ¥å—ä¸€ä¸ªæŸ¥è¯¢å¹¶è¿”å›ä¸€ä¸ªæ£€ç´¢åˆ°çš„æ–‡æ¡£å’Œå…ƒæ•°æ®åˆ—è¡¨ã€‚

```python
@app.post("/query", response_model=List[QueryResult])
def query(query: Query, client=Depends(get_weaviate_client)) -> List[Document]:
    """
    Query weaviate for documents
    """
    query_vector = get_embedding(query.text)

    results = (
        client.query.get(INDEX_NAME, ["document_id", "text"])
        .with_near_vector({"vector": query_vector})
        .with_limit(query.limit)
        .with_additional("certainty")
        .do()
    )

    docs = results["data"]["Get"][INDEX_NAME]

    return [
        QueryResult(
            document={"text": doc["text"], "document_id": doc["document_id"]},
            score=doc["_additional"]["certainty"],
        )
        for doc in docs
    ]
```
</details>

<details>
  <summary>æŸ¥çœ‹/deleteç«¯ç‚¹çš„å®ç°ç»†èŠ‚ã€‚</summary>

**å®ç°`/delete`ç«¯ç‚¹ï¼š**

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯æƒ³æ£€æŸ¥è¿”å›çš„å“åº”æ˜¯å¦æ­£ç¡®ï¼Œå¹¶ä¸”åœ¨åˆ é™¤ä¸€ä¸ªå¯¹è±¡åï¼ŒWeaviateå®ä¾‹ä¸­çš„æ€»å¯¹è±¡æ•°é‡å‡å°‘äº†ä¸€ä¸ªã€‚

```python
def test_delete(documents, weaviate_client):
    num_docs_before_delete = weaviate_client.data_object.get()["totalResults"]

    response = client.post("/delete", json={"document_id": "3"})
    assert response.status_code == 200

    num_docs_after_delete = weaviate_client.data_object.get()["totalResults"]

    assert num_docs_after_delete == num_docs_before_delete - 1
```

è€Œç«¯ç‚¹çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
@app.post("/delete")
def delete(delete_request: DeleteRequest, client=Depends(get_weaviate_client)):
    """
    Delete a document from weaviate
    """
    result = client.batch.delete_objects(
        class_name=INDEX_NAME,
        where={
            "operator": "Equal",
            "path": ["document_id"],
            "valueText": delete_request.document_id,
        },
    )

    if result["results"]["successful"] == 1:
        return {"status": "ok"}
    else:
        return {"status": "not found"}
```
</details>

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‘æ‚¨å±•ç¤ºäº†æˆ‘ä»¬çš„ç«¯ç‚¹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™å°†æ˜¯æ‚¨çš„æ’ä»¶æœ€ç‹¬ç‰¹çš„åœ°æ–¹ï¼Œæ ¹æ®æ‚¨æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åˆ›å»ºç›¸åº”çš„ç«¯ç‚¹å¹¶è¿›è¡Œæµ‹è¯•ã€‚

::::tip
Notice the docstrings weâ€™ve included with all of our endpoints, these will be very important in the next step!
::::

**æ­¥éª¤ 2: å‡†å¤‡æ’ä»¶æ¸…å•æ–‡ä»¶**

è¿™æ˜¯æ‚¨å‘OpenAIå’ŒChatGPTæŒ‡å®šæ’ä»¶å…¬å¼€çš„ç«¯ç‚¹çš„ä½ç½®ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œè¯´æ˜å®ƒä»¬å¦‚ä½•ä½¿ç”¨è¿™äº›ç«¯ç‚¹æ¥å®Œæˆç‰¹å®šä»»åŠ¡ï¼Œä»¥åŠå¦‚æœæœªæ­£ç¡®ä½¿ç”¨è¿™äº›ç«¯ç‚¹æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ç­‰ç­‰ï¼[OpenAIçš„æŒ‡å—](https://platform.openai.com/docs/plugins/getting-started/plugin-manifest)æŒ‡å‡ºï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼š[`openapi.yaml`æ–‡ä»¶](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/.well-known/openapi.yaml)å’Œ[`ai-plugin.json`æ–‡ä»¶](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/.well-known/ai-plugin.json)ã€‚

æ­£å¦‚æ‚¨æ‰€è§ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ”¾åœ¨`.well-known`ç›®å½•ä¸­ï¼Œå¹¶ä¸”å¿…é¡»æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å°†å…¶æŒ‚è½½åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»¥ä¾¿ChatGPTèƒ½å¤Ÿæ­£ç¡®åœ°ä½¿ç”¨å®ƒä»¬ã€‚

`app.mount("/.well-known", StaticFiles(directory=".well-known"), name="static")`

è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š

`ai-plugin.json`

```json
{
    "schema_version": "v1",
    "name_for_human": "Weaviate Retrieval Plugin V2",
    "name_for_model": "Weaviate_Retrieval_Plugin",
    "description_for_human": "Plugin to interact with documents using natural language. You can query, add and remove documents.",
    "description_for_model": "Plugin to interact with documents using natural language. You can query, add and remove documents.",
    "auth": {
        "type": "user_http",
        "authorization_type": "bearer"
      },
    "api": {
        "type": "openapi",
        "url": "https://demo-retrieval-app.fly.dev/.well-known/openapi.yaml",
        "is_user_authenticated": false
    },
    "logo_url": "https://demo-retrieval-app.fly.dev/.well-known/logo.png",
    "contact_email": "support@example.com",
    "legal_info_url": "http://www.example.com/legal"
}
```
è¿™ä¸ªæ–‡ä»¶æŒ‡å®šäº†åº”ç”¨ç¨‹åºçš„åç§°ã€æ ‡å¿—èµ„äº§ç­‰æ•°æ®ï¼Œè¿˜æœ‰æ›´æœ‰è¶£çš„æ˜¯ï¼Œåœ¨`name_for_model`å­—æ®µä¸‹ï¼ŒæŒ‡å®šäº†æ¨¡å‹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºChatGPT/GPT4.0ï¼‰å°†å¦‚ä½•å¼•ç”¨æ’ä»¶ä»¥åŠæ’ä»¶çš„æè¿°`description_for_model`ï¼Œè¿™äº›æè¿°å¯ä»¥è¢«æ¨¡å‹è¯»å–å’Œç†è§£ã€‚

`openapi.yaml`

![YAML](./img/openaiapi.png)

è¿™ä¸ªæ–‡ä»¶æœ€é‡è¦çš„æ˜¯æŒ‡å®šäº†ChatGPTè¦ä½¿ç”¨çš„ç«¯ç‚¹ï¼Œå¹¶å¯¹æ¯ä¸ªç«¯ç‚¹è¿›è¡Œäº†æè¿°ã€‚

::::tip
Generating this `.yaml` file was quite challenging until we realized that you could simply generate the spec in json format by going to the SwaggerUI using `/docs` and clicking on the `/openapi.json` link. Then you can use this [website](https://www.json2yaml.com/) to convert from `.json` to `.yaml`.
::::


è¿™ä¸¤ä¸ªæ–‡ä»¶å¯¹äºChatGPTæ­£ç¡®ç†è§£å’Œåˆ©ç”¨æ’ä»¶çš„æš´éœ²ç«¯ç‚¹éå¸¸é‡è¦ã€‚

æˆ‘ä»¬åœ¨å®éªŒä¸­å‘ç°ä¸€ä¸ªéå¸¸æœ‰è¶£çš„å‘ç°æ˜¯ï¼ŒChatGPTä¼šè¯»å–è¿™äº›æ–‡ä»¶ï¼Œä¸ä»…äº†è§£ä½•æ—¶ä½¿ç”¨ç«¯ç‚¹ï¼Œè¿˜äº†è§£å¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼å› æ­¤ï¼Œå¦‚æœChatGPTæ²¡æœ‰æ­£ç¡®ä½¿ç”¨æ‚¨çš„ç«¯ç‚¹ï¼Œæ‚¨åº”è¯¥å°è¯•æ”¹è¿›æ’ä»¶å’Œç«¯ç‚¹çš„æè¿°ã€‚OpenAIä¸ºåˆ›å»ºè¿™äº›æè¿°æä¾›äº†ä¸€äº›[æœ€ä½³å®è·µ](https://platform.openai.com/docs/plugins/getting-started/writing-descriptions)ã€‚æ ¹æ®æˆ‘ä»¬çš„å®éªŒï¼Œæˆ‘ä»¬å‘ç°å¦‚æœæè¿°ä¸è¶³ä»¥æè¿°å¦‚ä½•ä½¿ç”¨ç«¯ç‚¹ï¼ŒChatGPTå°†ä»¥é”™è¯¯çš„è¯­æ³•è°ƒç”¨ç«¯ç‚¹ï¼Œå¹¶åœ¨å¤±è´¥åé‡è¯•ã€‚è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š

![é”™è¯¯](./img/error.png)

**è¦ç‚¹ï¼š** ChatGPTæ²¡æœ‰ç¡¬ç¼–ç çš„æŒ‡ä»¤æ¥å‘Šè¯‰ä½ ä½•æ—¶ä»¥åŠå¦‚ä½•ä½¿ç”¨æ’ä»¶ç«¯ç‚¹ã€‚æ‚¨éœ€è¦éå¸¸å°å¿ƒåœ°æè¿°æ‚¨çš„æ’ä»¶å’Œç«¯ç‚¹ï¼Œä»¥ä¾¿ChatGPTå¯ä»¥æŒ‰é¢„æœŸä½¿ç”¨å®ƒä»¬ï¼FastAPIä¸ºæ‚¨ç”Ÿæˆçš„`openapi.json`è§„èŒƒæ˜¯åŸºäºæ‚¨åœ¨ä»£ç ä¸­å¯¹ç«¯ç‚¹è¿›è¡Œæ–‡æ¡£åŒ–çš„æ–¹å¼ï¼Œå³å‡½æ•°çš„åç§°ã€æ–‡æ¡£å­—ç¬¦ä¸²ã€æŸ¥è¯¢æè¿°å’Œpydanticæ¨¡å‹ä¸­å­—æ®µçš„æè¿°ã€‚å®Œæˆè¿™äº›æ­¥éª¤ä¸åœ¨æœ¬åšæ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œè¯·å‚è€ƒFastAPIæ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›ä¸ºæ‚¨çš„æ’ä»¶ç¼–å†™å®Œæ•´å’Œå…¨é¢çš„æ–‡æ¡£ï¼Œå› ä¸ºæ–‡æ¡£æ˜¯ç¡®ä¿æ­£ç¡®ä½¿ç”¨æ’ä»¶çš„å…³é”®ï¼

å¦å¤–ï¼Œå½“æŒ‡å®šæè¿°ã€æ–‡æ¡£å­—ç¬¦ä¸²ç­‰å†…å®¹æ—¶ï¼Œæ‚¨éœ€è¦æ³¨æ„ä¸è¦è¶…è¿‡ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œå› ä¸ºæ’ä»¶æè¿°ã€APIè¯·æ±‚å’ŒAPIå“åº”éƒ½ä¼šæ’å…¥åˆ°ä¸ChatGPTçš„å¯¹è¯ä¸­ã€‚è¿™äº›éƒ½ä¼šå ç”¨æ¨¡å‹çš„ä¸Šä¸‹æ–‡é™åˆ¶ã€‚

**æ­¥éª¤3ï¼šåœ¨ChatGPTç”¨æˆ·ç•Œé¢ä¸Šè¿›è¡Œæ’ä»¶çš„æœ¬åœ°éƒ¨ç½²å’Œæµ‹è¯•**

å…è®¸http://localhost:8000å’Œhttps://chat.openai.comå‘æ’ä»¶çš„æœåŠ¡å™¨å‘èµ·è·¨åŸŸè¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨FastAPIçš„CORSMiddlewareä¸­é—´ä»¶è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚

```python
# for localhost deployment
if os.getenv("ENV", "dev") == "dev":
    origins = [
        f"http://localhost:8000",
        "https://chat.openai.com",
    ]

    app.add_middleware(
        CORSMiddleware,
        allow_origins=origins,
        allow_credentials=True,
        allow_methods=["*"],
        allow_headers=["*"],
    )
```

ä¸Šè¿°ä»£ç ä»…åœ¨æœ¬åœ°æµ‹è¯•æœŸé—´ä½¿ç”¨ï¼Œå¹¶å°†ä½¿æ‚¨åœ¨æœ¬åœ°éƒ¨ç½²çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ChatGPTè¿›è¡Œé€šä¿¡ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ’ä»¶å®é™…ä¸Šæœ‰ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œæ ¹æ®æ‰€ä½¿ç”¨çš„èº«ä»½éªŒè¯ç±»å‹è€Œæœ‰æ‰€ä¸åŒï¼Œå¯¹äºæœ¬åœ°éƒ¨ç½²å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨èº«ä»½éªŒè¯ï¼Œè€Œå¯¹äºè¿œç¨‹éƒ¨ç½²ï¼Œæˆ‘ä»¬ä½¿ç”¨Bearerä»¤ç‰Œå’Œhttpsï¼Œç¨åæˆ‘ä»¬å°†è¿›è¡Œè¯´æ˜ã€‚æŒ‰ç…§[æ­¤å¤„](https://platform.openai.com/docs/plugins/getting-started/running-a-plugin)çš„è¯¦ç»†è¯´æ˜ï¼Œæ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œæ’ä»¶ã€‚è¿™å°†å…è®¸æ‚¨é€šè¿‡ChatGPT UIæµ‹è¯•æ‰€æœ‰ç«¯ç‚¹ï¼Œå¹¶ç¡®ä¿å®ƒä»¬æ­£å¸¸è¿è¡Œã€‚

åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨æœ¬åœ°è¿›è¡Œçš„ä¸€äº›ç«¯ç‚¹æµ‹è¯•ï¼š

![test1](./img/test1.png)
![test2](./img/test2.png)
*ç¡®ä¿upsertå’Œqueryç«¯ç‚¹æ­£å¸¸å·¥ä½œã€‚è¯·æ³¨æ„ï¼Œæ ¹æ®æˆ‘ä»¬åœ¨æç¤ºä¸­ä½¿ç”¨çš„è¯­è¨€ï¼ŒChatGPTå°†é€‰æ‹©è°ƒç”¨ç›¸åº”çš„ç«¯ç‚¹ã€‚*

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šè¿œç¨‹éƒ¨ç½²åˆ°Fly.io

**æ­¥éª¤1ï¼šå‡†å¤‡å°†æ’ä»¶è¿œç¨‹éƒ¨ç½²åˆ°Fly.io**

ä¸€æ—¦æˆ‘ä»¬åœ¨æœ¬åœ°æ»¡æ„åœ°æµ‹è¯•äº†æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°è¿œç¨‹å¹¶å®‰è£…åˆ°ChatGPTä¸­ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åˆ†äº«æ’ä»¶ç»™é‚£äº›æœ‰alphaè®¿é—®æƒé™çš„äººæ‰€éµå¾ªçš„æ­¥éª¤ï¼š

1. åˆ›å»ºè¿œç¨‹Weaviateå®ä¾‹ï¼šè¿™æ˜¯ä½¿ç”¨[Weaviateäº‘æœåŠ¡](https://console.weaviate.cloud/)å®Œæˆçš„ã€‚

2. æ·»åŠ ä¸€ä¸ª[dockerfile](https://github.com/weaviate/howto-weaviate-retrieval-plugin/blob/main/Dockerfile)ã€‚è¿™ä¸ªdockerfileåªæ˜¯ä¸€ä¸ªä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼ŒåŸºäº[OpenAIæä¾›çš„æ¨¡æ¿æ–‡ä»¶](https://github.com/openai/chatgpt-retrieval-plugin/blob/main/Dockerfile)ï¼Œå°†ç”¨äºè¿œç¨‹è®¾ç½®æ‚¨çš„ç¯å¢ƒå¹¶å¯åŠ¨æœåŠ¡å™¨ã€‚

3. æ›´æ–°æ’ä»¶æ¸…å•é…ç½®æ–‡ä»¶ `ai-plugin.json` å’Œ `openapi.yaml`ï¼Œç°åœ¨ä½¿ç”¨èº«ä»½éªŒè¯ï¼ˆ[ä½¿ç”¨æŒ‡å—](https://platform.openai.com/docs/plugins/getting-started/plugin-manifest)ï¼‰å½¢å¼ä¸ºBearerä»¤ç‰Œå’Œæ‚¨æ–°åˆ›å»ºçš„WCSå®ä¾‹ï¼Œè€Œä¸æ˜¯localhostã€‚

4. æ›´æ–°åº”ç”¨ç¨‹åºï¼Œç¡®ä¿æ‰€æœ‰é€šä¿¡éƒ½ç»è¿‡èº«ä»½éªŒè¯ã€‚

æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/weaviate/howto-weaviate-retrieval-plugin/commit/9ba22539a321e6cb8cb676c2e3a6f3a945a3f967)æŸ¥çœ‹é¡¹ç›®çš„å®Œæ•´å·®å¼‚ï¼Œä»¥äº†è§£å®ƒæ˜¯å¦‚ä½•å‡†å¤‡å¥½è¿›è¡Œè¿œç¨‹éƒ¨ç½²çš„ã€‚

**æ­¥éª¤2ï¼šåœ¨Fly.ioä¸Šéƒ¨ç½²å¹¶åœ¨ChatGPTä¸­å®‰è£…**

è¿™æ˜¯æœ€åä¸€æ­¥ï¼Œå…è®¸æ‚¨å°†æ’ä»¶éƒ¨ç½²åˆ°Fly.ioï¼Œåœ¨[è¿™é‡Œ](https://github.com/openai/chatgpt-retrieval-plugin/blob/main/docs/deployment/flyio.md)æä¾›äº†è¯¦ç»†çš„è¯´æ˜ï¼Œå¯ä»¥æŒ‰ç…§æ–‡æ¡£ä¸­çš„æŒ‡ç¤ºè¿›è¡Œæ“ä½œã€‚å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ChatGPTï¼Œå¦‚æœæ‚¨æœ‰æ’ä»¶çš„Alphaæµ‹è¯•æƒé™ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šæ’ä»¶çš„æ‰˜ç®¡URLå¹¶æä¾›èº«ä»½éªŒè¯çš„Bearerä»¤ç‰Œæ¥å®‰è£…æ’ä»¶ã€‚

## ç»“è®º

å¥³å£«ä»¬å…ˆç”Ÿä»¬ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ç”¨äºå¢å¼ºChatGPTçš„Weavaiteæ£€ç´¢æ’ä»¶çš„è¿‡ç¨‹ã€‚åˆ›å»ºä¸åŒçš„æ’ä»¶çš„è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬ç›¸ä¿¡å¤§éƒ¨åˆ†æ­¥éª¤å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ‰§è¡Œï¼Œå”¯ä¸€çš„å˜åŒ–å¯èƒ½åœ¨ç¬¬äºŒéƒ¨åˆ†ï¼Œå³æ‚¨å®šä¹‰ç‰¹å®šäºæ’ä»¶çš„ç«¯ç‚¹çš„åœ°æ–¹ã€‚

è®©æˆ‘ä»¬é€šè¿‡å¯è§†åŒ–ChatGPTå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ’ä»¶æ¥ç»“æŸã€‚ä¸‹é¢çš„å›¾ç¤ºè¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨`/query`ç«¯ç‚¹ã€‚æ ¹æ®æç¤ºï¼Œå®ƒè¿˜å¯ä»¥è°ƒç”¨`/delete`å’Œ`/upsert`ç«¯ç‚¹ã€‚

![diagram](./img/diagram-light.png#gh-light-mode-only)
![diagram](./img/diagram-dark.png#gh-dark-mode-only)
*æ›´å…·ä½“åœ°è¯´ï¼Œå½“ç”¨æˆ·æç¤ºChatGPTæ—¶ï¼Œå®ƒå°†æŸ¥çœ‹`openapi.yaml`æ–‡ä»¶ä»¥è¯»å–ç»ˆç«¯æè¿°ï¼Œå¹¶å†³å®šåœ¨æç¤ºæ‰§è¡Œä¸­ä½¿ç”¨çš„é€‚å½“ç»ˆç«¯ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®ƒé€‰æ‹©ä½¿ç”¨`/query`ç»ˆç«¯ã€‚ç„¶åï¼Œå®ƒå°†å°è¯•æ„å»ºæ­£ç¡®çš„è¯·æ±‚ï¼Œå¹¶åœ¨å¤±è´¥æ—¶è¿›è¡Œé‡è¯•ã€‚æŸ¥è¯¢å°†ä»Weaviateè¿”å›ä¸åŸå§‹æç¤ºç›¸å…³çš„æ–‡æ¡£ï¼ŒChatGPTå°†ä½¿ç”¨è¿™äº›æ–‡æ¡£æ¥å›ç­”åŸå§‹æç¤ºï¼*

import WhatNext from '/_includes/what-next.mdx'

<WhatNext />