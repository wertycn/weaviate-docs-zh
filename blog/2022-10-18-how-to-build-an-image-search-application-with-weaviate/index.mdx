---
authors:
- erika
date: 2022-10-18
description: Learn how to use build an image search application using the Img2vec-neural
  module in Weaviate.
image: ./img/hero.png
slug: how-to-build-an-image-search-application-with-weaviate
tags:
- how-to
title: How to build an Image Search Application with Weaviate
---

![å¦‚ä½•ä½¿ç”¨Weaviateæ„å»ºå›¾åƒæœç´¢åº”ç”¨ç¨‹åº](./img/hero.png)

<!-- çœç•¥ -->

æœ€è¿‘ï¼Œæˆ‘å’Œæˆ‘çš„åŒäº‹Marcinï¼ˆæ¥è‡ªWeaviateæ ¸å¿ƒå›¢é˜Ÿçš„å·¥ç¨‹å¸ˆï¼‰ä¸€èµ·åˆä½œåšäº†ä¸€ä¸ªéå¸¸é…·çš„æ¼”ç¤ºé¡¹ç›®ã€‚è¿™ä¸ªé¡¹ç›®çš„æƒ³æ³•æ˜¯æ„å»ºä¸€ä¸ªç”¨äºç‹—çš„å›¾åƒæœç´¢åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥æä¾›ä¸€å¼ ç‹—çš„å›¾ç‰‡ï¼Œåº”ç”¨ç¨‹åºä¼šè¿”å›æœ€ç›¸ä¼¼çš„å“ç§ã€‚å¦‚æœç”¨æˆ·æä¾›äº†ä»–ä»¬ä¼´ä¾£çš„ç…§ç‰‡ï¼ˆæˆ‘å¯èƒ½åœ¨æˆ‘çš„ç”·æœ‹å‹èº«ä¸Šæµ‹è¯•äº†è¿™ä¸ª ğŸ˜„ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸å…¶æœ€ç›¸ä¼¼çš„å“ç§ã€‚

ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ¼”ç¤ºçš„æ­å»ºï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šæ¥åˆ†äº«ã€‚è¿™ç¯‡åšæ–‡ä¸ºæ‚¨æ„å»ºå¦ä¸€ä¸ªåŸºäºå›¾åƒè¯†åˆ«æˆ–äº§å“æœç´¢çš„åº”ç”¨ç¨‹åºæ‰“ä¸‹äº†åŸºç¡€ã€‚

æœ¬åšå®¢æ–‡ç« å°†æŒ‡å¯¼æ‚¨ä½¿ç”¨**Python**ã€**Weaviate**å’Œ**Flask**æ„å»ºä¸€ä¸ªå…¨æ ˆWebåº”ç”¨ç¨‹åºã€‚åœ¨å®Œæˆé˜…è¯»åï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªå›¾åƒæœç´¢åº”ç”¨ç¨‹åºï¼è¯¥åº”ç”¨ç¨‹åºå°†æ¥æ”¶ä¸€å¼ ç‹—çš„å›¾ç‰‡ï¼Œå¹¶ç«‹å³è¿”å›æ•°æ®åº“ä¸­ä¸è¯¥ç‹—çš„å“ç§æœ€åŒ¹é…çš„å›¾ç‰‡ã€‚

ä½ å¯èƒ½å·²ç»çŸ¥é“Weaviateå¯ä»¥ç”¨æ¥è¿›è¡Œå¿«é€Ÿçš„å‘é‡æœç´¢ã€‚ä½†ä½ å¯èƒ½ä¸çŸ¥é“çš„æ˜¯ï¼Œå®ƒè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œå…¶ä»–æ•°æ®ç±»å‹çš„å‘é‡åŒ–å’Œæœç´¢ï¼Œæ— è®ºæ˜¯éŸ³é¢‘ã€å›¾åƒè¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ•°æ®ã€‚

æœ¬åšå®¢æ–‡ç« å‡è®¾ä½ å·²ç»ç†Ÿæ‚‰å‘é‡æœç´¢ï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•ä½¿ç”¨Dockerå¯åŠ¨Weaviateå®ä¾‹ã€‚å¦‚æœä¸ç†Ÿæ‚‰ï¼Œæ²¡å…³ç³»-è¿™äº›æŒ‡å—ä¼šå¸®åŠ©ä½ ï¼
* [äº†è§£Weaviate](/developers/weaviate/concepts)
* [Weaviateå®‰è£…](/developers/weaviate/installation)
* [Dockerå®‰è£…](https://docs.docker.com/engine/install/)

[æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ](/blog/why-is-vector-search-so-fast)äº†è§£æ›´å¤šå…³äºä¸ºä»€ä¹ˆå‘é‡æ•°æ®åº“å¦‚æ­¤å¿«é€Ÿä»¥åŠå®ƒä»¬çš„å·¥ä½œåŸç†ã€‚

æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­æä¾›ä»£ç ç‰‡æ®µï¼Œä½†æ‚¨å¯ä»¥åœ¨[Weaviate Examples GitHubä»“åº“](https://github.com/weaviate/weaviate-examples)çš„`nearest-neighbor-dog-search`ç›®å½•ä¸‹æ‰¾åˆ°å®Œæ•´çš„ä»£ç åº“ã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨é€šè¿‡å…‹éš†è¯¥ä»“åº“ä¸æˆ‘ä»¬ä¸€èµ·è·Ÿéšï¼

æœ¬åšæ–‡æ¶µç›–ä»¥ä¸‹å†…å®¹ï¼š
1. [å›¾åƒå‘é‡åŒ–](#image-vectorization)
2. [Weaviateæ•°æ®åº“](#weaviate-database)
3. [Flaskåº”ç”¨ç¨‹åº](#flask-application)

## å›¾åƒå‘é‡åŒ–

åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†æœç´¢ä¸€ä¸ªåŒ…å«ç‹—å›¾ç‰‡çš„æ•°æ®é›†ã€‚å½“å‰æ•°æ®é›†ä¸­æœ‰åå¼ ä¸åŒå“ç§çš„ç‹—çš„å›¾ç‰‡ï¼›ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥çµæ´»åœ°æ›´æ”¹æ•°æ®é›†ã€‚å°½ç®¡æˆ‘åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº†ç‹—çš„å›¾ç‰‡ï¼Œä½†æ‚¨å¯ä»¥è½»æ¾åœ°ç”¨ä»»ä½•å›¾ç‰‡æ›¿æ¢ç‹—çš„å›¾ç‰‡ï¼Œä»¥é€‚åº”æ‚¨è‡ªå·±çš„ç”¨ä¾‹ğŸ¤”ã€‚

è¯·æ³¨æ„ï¼Œç¡®ä¿å°†æ–°çš„å›¾ç‰‡æ·»åŠ åˆ° `flask-app/static/img` æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶è¿è¡Œ `images-to-base64.py` å’Œ `upload-data-objects.py` æ–‡ä»¶ã€‚

å¯¹äºæˆ‘ä»¬è¿™æ ·çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¯†åˆ«ç›¸ä¼¼ç±»å‹çš„ç‹—ï¼Œå‘é‡åŒ–å¿…é¡»ä»¥ä¸€ç§èƒ½å¤Ÿæ•æ‰æœ‰å…³ç‹—çš„ä¿¡æ¯ï¼ˆå“ç§ã€å¤§å°ã€é¢œè‰²ç­‰ï¼‰çš„æ–¹å¼å·¥ä½œã€‚

Weaviateä¸­çš„`img2vec-neural`æ¨¡å—å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ï¼è¯¥æ¨¡å—å°†æ¯ä¸ªå›¾åƒè½¬æ¢ä¸ºèƒ½å¤Ÿä»£è¡¨å…¶å†…å®¹çš„å‘é‡ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åŸºäºè¯­ä¹‰ç›¸ä¼¼æ€§æœç´¢å›¾åƒã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`img2vec-neural`å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œçœ‹çœ‹åŸºäºå›¾åƒçš„ç‹—ä¹‹é—´æœ‰å¤šç›¸ä¼¼ã€‚

### Img2vec-neuralæ¨¡å—
[Weaviateçš„img2vec-neuralæ¨¡å—](/developers/weaviate/modules/retriever-vectorizer-modules/img2vec-neural) æ˜¯ä¸€ä¸ªçµæ´»çš„å‘é‡åŒ–å™¨ï¼Œå¯ä»¥å°†å›¾åƒè½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„å‘é‡ã€‚`ResNet-50` æ˜¯åœ¨Weaviateä¸Šæ”¯æŒçš„ç¬¬ä¸€ä¸ªæ¨¡å‹ã€‚`ResNet-50` æ˜¯ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼Œå®ƒæ˜¯åœ¨[ImageNetæ•°æ®åº“](https://www.image-net.org/)ä¸Šè®­ç»ƒçš„ã€‚è¯¥æ¨¡å‹åœ¨1000ä¸‡å¤šå¹…å›¾åƒå’Œ2ä¸‡ä¸ªç±»åˆ«ä¸Šè¿›è¡Œäº†è®­ç»ƒã€‚

## Weaviateæ•°æ®åº“
### è®¾ç½®
è¯¥æ¼”ç¤ºåŒ…å«ä¸€ä¸ª `docker-compose.yml` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†è¿è¡Œæ­¤æ¼”ç¤ºæ‰€éœ€çš„æ‰€æœ‰ Weaviate æ¨¡å—ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬çš„æ¨¡å—æ˜¯åŸºäº `ResNet-50` æ¨¡å‹è®­ç»ƒçš„ `img2vec-neural`ã€‚è¦å¯åŠ¨æ‚¨çš„ Weaviate å®ä¾‹ï¼Œè¯·å¯¼èˆªåˆ°ä»å…‹éš†çš„ Git ä»“åº“ä¸­çš„ `nearest-neighbor-dog-search` ç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼›

```
docker-compose up -d
```
ä¸€æ—¦ Weaviate å¯åŠ¨ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å®ƒæ˜¯å¦æ­£åœ¨è¿è¡Œï¼š

```bash
python weaviate-test.py
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¼€å§‹äº†ï¼
```
{"classes": []}
```

### æ¨¡å¼é…ç½®

æˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«ååªç‹—ï¼Œæ¯åªç‹—éƒ½åŒ…å«ä»¥ä¸‹å±æ€§: å“ç§ã€å›¾ç‰‡ã€é‡é‡å’Œæ–‡ä»¶è·¯å¾„ã€‚æ¨¡å¼å®šä¹‰äº†æˆ‘ä»¬å°†åœ¨Weaviateæ•°æ®åº“ä¸­å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªå¯¹è±¡ç±»å‹è¢«ç§°ä¸ºä¸€ä¸ª`class`ã€‚

è¿™åŒ…æ‹¬ç±»åï¼Œæˆ‘ä»¬çš„æƒ…å†µä¸‹æ˜¯"Dog"ï¼Œä»¥åŠå±æ€§ï¼Œå¦‚`breed`ã€`image`å’Œ`filepath`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ çŸ¢é‡åŒ–å™¨å®šä¹‰ï¼Œå³`img2vec-neural`æ¨¡å—ï¼Œä»¥ä¾¿WeaviateçŸ¥é“ä½¿ç”¨ç‰¹å®šçš„çŸ¢é‡åŒ–å™¨ã€‚

æˆ‘ä»¬å°†å‘Šè¯‰Weaviateï¼Œå“ç§ï¼ˆbreedï¼‰å’Œæ–‡ä»¶è·¯å¾„ï¼ˆfilepathï¼‰çš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œé‡é‡ï¼ˆweightï¼‰å­˜å‚¨ä¸ºæ•´æ•°ï¼Œå›¾åƒå­˜å‚¨ä¸º`blob`æ•°æ®ç±»å‹ã€‚å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œæ¨¡å¼å®šä¹‰åº”å¦‚ä¸‹æ‰€ç¤ºï¼›

```python
schema = {
   "classes": [
       {
           "class": "Dog",
           "description": "Images of different dogs",
           "moduleConfig": {
               "img2vec-neural": {
                   "imageFields": [
                       "image"
                   ]
               }
           },
           "vectorIndexType": "hnsw",
           "vectorizer": "img2vec-neural", # the img2vec-neural Weaviate vectorizer
           "properties": [
               {
                   "name": "breed",
                   "dataType": ["string"],
                   "description": "name of dog breed",
               },
               {
                   "name": "image",
                   "dataType": ["blob"],
                   "description": "image",
               },
               {
                   "name": "filepath",
                   "dataType":["string"],
                   "description": "filepath of the images",
               }
           ]
       }
   ]
}
```
ä¸€æ—¦å®šä¹‰äº†æ¨¡å¼ï¼Œå°±å¯ä»¥å°†å…¶æ·»åŠ åˆ°Weaviateä¸­ã€‚
```
client.schema.create(schema)
```

è¿è¡Œ`create-schema.py`å°†æ¨¡å¼æ·»åŠ åˆ°æ‚¨çš„Weaviateå®ä¾‹ä¸­ï¼›

```bash
python create-schema.py
```

### å›¾ç‰‡è½¬ä¸º Base64
æˆ‘ä»¬å³å°†å‡†å¤‡å°†æˆ‘ä»¬çš„ Weaviate æ•°æ®åº“å¡«æ»¡å¯çˆ±çš„ç‹—ç‹—ï¼é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡ç¼–ç ä¸º Base64 å€¼ã€‚å°†å›¾ç‰‡ç¼–ç ä¸º Base64 æ˜¯ä½¿ç”¨ [blob æ•°æ®ç±»å‹](/developers/weaviate/config-refs/datatypes) çš„è¦æ±‚ï¼Œæˆ‘ä»¬å·²åœ¨æ¨¡å¼ä¸­å®šä¹‰äº†è¯¥æ•°æ®ç±»å‹ã€‚

æ•°æ®é›†ä¸­çš„åå¼ å›¾ç‰‡å­˜å‚¨åœ¨ `flask-app/static/img` æ–‡ä»¶å¤¹ä¸­ã€‚è¦å°†å›¾ç‰‡è½¬æ¢ä¸º Base64ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python images-to-base64.py
```

æ³¨æ„ï¼Œbase64 å›¾ç‰‡å­˜å‚¨åœ¨ `base64_images` æ–‡ä»¶å¤¹ä¸­ã€‚

### ä¸Šä¼ æ•°æ®å¯¹è±¡
ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº†æ¨¡å¼å¹¶å°†å›¾ç‰‡è½¬æ¢ä¸º base64 å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®å¯¹è±¡ä¸Šä¼ åˆ° Weaviateã€‚

åœ¨å°†æ•°æ®å¯¹è±¡ä¸Šä¼ åˆ° Weaviate æ—¶ï¼Œæ‚¨å¸Œæœ›å°†æ•°æ®åˆ†æ‰¹å¯¼å…¥ã€‚æ‰¹é‡å¯¼å…¥çš„é€Ÿåº¦æ¯”é€ä¸ªä¸Šä¼ å¯¹è±¡è¦å¿«ã€‚è®©æˆ‘ä»¬é…ç½®æ‰¹å¤„ç†è¿‡ç¨‹ï¼Œä»¥ä¾¿æ¯æ¬¡ä¸Šä¼ 100ä¸ªå¯¹è±¡ï¼Œä»¥é˜²æˆ‘ä»¬æ·»åŠ æ›´å¤šå›¾ç‰‡ã€‚

```python
def set_up_batch():
   client.batch.configure(
       batch_size=100,
       dynamic=True,
       timeout_retries=3,
       callback=None,
   )
```

æˆ‘ä»¬éœ€è¦å®šä¹‰è¦ä¸Šä¼ çš„æ•°æ®å±æ€§ã€‚ä»¥ä¸‹åŠŸèƒ½å°†ä¼šï¼š
1. è·å–`base64_images`æ–‡ä»¶å¤¹ä¸­çš„å›¾åƒã€‚
2. å»é™¤æ–‡ä»¶æ‰©å±•åï¼Œåªä¿ç•™å“ç§åç§°ã€‚
3. è®¾ç½®å±æ€§å€¼ï¼Œå¦‚æ¨¡å¼ä¸­æ‰€å®šä¹‰ã€‚
4. å°†æ–°çš„æ•°æ®å¯¹è±¡ä¸Šä¼ åˆ°Weaviateã€‚

```python
def import_data():

   with client.batch as batch:
       # Iterate over all .b64 files in the base64_images folder
       for encoded_file_path in os.listdir("./base64_images"):
           with open("./base64_images/" + encoded_file_path) as file:
               file_lines = file.readlines()

           base64_encoding = " ".join(file_lines)
           base64_encoding = base64_encoding.replace("\n", "").replace(" ", "")

           # remove .b64 to get the original file name
           image_file = encoded_file_path.replace(".b64", "")

           # remove image file extension and swap - for " " to get the breed name
           breed = re.sub(".(jpg|jpeg|png)", "", image_file).replace("-", " ")

           # The properties from our schema
           data_properties = {
               "breed": breed,
               "image": base64_encoding,
               "filepath": image_file,
           }

           batch.add_data_object(data_properties, "Dog")
```

ç°åœ¨æˆ‘ä»¬å°†è¿æ¥åˆ°æœ¬åœ°ä¸»æœºå¹¶ä¸Šä¼ æ•°æ®å¯¹è±¡ã€‚
```python
client = weaviate.Client("http://localhost:8080")
set_up_batch()
clear_up_dogs()
import_data()
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ­¤æ–‡ä»¶ï¼š
```bash
python upload-data-objects.py
```

å°±åƒè¿™æ ·ï¼Œæ‚¨å·²ç»ç”¨å¯çˆ±ç‹—ç‹—çš„å›¾ç‰‡å’Œå®ƒä»¬çš„å‘é‡è¡¨ç¤ºå¡«å……äº†æ‚¨çš„Weaviateæ•°æ®åº“ï¼

ä»¥ä¸‹æ˜¯æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æ‰€åšçš„å›é¡¾ï¼š
1. å®šä¹‰äº†Weaviateæ¨¡å¼
2. å°†å›¾ç‰‡è½¬æ¢ä¸ºbase64å€¼
3. å°†æ•°æ®å¯¹è±¡ä¸Šä¼ åˆ°Weaviate

![Weaviateç‹—ç‹—](./img/weaviate-dogs1.jpg)

## Flaskåº”ç”¨ç¨‹åº
[Flask](https://flask.palletsprojects.com/en/2.2.x/) æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„ Web åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚ä½¿ç”¨ Flask æ˜¯æ„å»º Web åº”ç”¨ç¨‹åºçš„ä¸€ç§å¿«é€Ÿç®€ä¾¿çš„æ–¹å¼ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨æœ¬æŒ‡å—ä¸­ä½¿ç”¨å®ƒã€‚

### åº”ç”¨ç¨‹åºæ–‡ä»¶
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæˆ‘ä»¬çš„ Flask åº”ç”¨ç¨‹åºå¹¶å°†å…¶è¿æ¥åˆ°æˆ‘ä»¬çš„ Weaviate å®¢æˆ·ç«¯ã€‚

```python
app = Flask(__name__)
app.config["UPLOAD_FOLDER"] = "/temp_images"
client = weaviate.Client("http://localhost:8080")
```

æˆ‘ä»¬å°†åœ¨Weaviateä¸­ä½¿ç”¨[`nearImage`](/developers/weaviate/modules/retriever-vectorizer-modules/img2vec-neural#nearimage-search)æ“ä½œç¬¦ï¼Œä»¥ä¾¿æœç´¢ä¸ç”¨æˆ·ä¸Šä¼ çš„å›¾åƒæœ€æ¥è¿‘çš„å›¾åƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ„å»º`weaviate_img_search`å‡½æ•°æ¥è·å–ç›¸å…³ç»“æœã€‚æˆ‘ä»¬çš„æœç´¢æŸ¥è¯¢çš„å“åº”å°†åŒ…æ‹¬ä¸Dogç±»ä¸­æœ€æ¥è¿‘çš„å¯¹è±¡ã€‚ä»å“åº”ä¸­ï¼Œè¯¥å‡½æ•°å°†è¾“å‡ºå¸¦æœ‰å“ç§åç§°å’Œæ–‡ä»¶è·¯å¾„çš„ç‹—çš„å›¾åƒã€‚è¯·æ³¨æ„ï¼ŒæŸ¥è¯¢ä¹Ÿæ˜¯è¿™æ ·æ„å»ºçš„ï¼Œä»¥ä¾¿å°†å“åº”é™åˆ¶ä¸ºä¸¤ä¸ªç»“æœã€‚

```python
def weaviate_img_search(img_str):
   sourceImage = { "image": img_str}

   weaviate_results = client.query.get(
       "Dog", ["filepath","breed"]
       ).with_near_image(
           sourceImage, encode=False
       ).with_limit(2).do()

   return weaviate_results["data"]["Get"]["Dog"]
```

è¿™å¾ˆé…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„æŸ¥è¯¢Weaviateæ¥æ‰¾åˆ°å¤–è§‚ç›¸ä¼¼çš„ç‹—ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å€ŸåŠ©[Weaviateçš„ANNç´¢å¼•](/developers/weaviate/concepts/vector-index)åœ¨æ¯«ç§’çº§åˆ«ä¸Šæ‰©å±•åˆ°æ•°ç™¾ä¸‡å¼ å›¾åƒã€‚

åˆ›å»ºå®Œåº”ç”¨ç¨‹åºåï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ç½‘ç«™ä¸Šçš„é¡µé¢ã€‚é¦–é¡µå°†æ˜¾ç¤ºæˆ‘ä»¬æ•°æ®é›†ä¸­çš„åå¼ ç‹—çš„å›¾ç‰‡ã€‚å¦‚æœæ·»åŠ äº†å›¾ç‰‡ï¼Œå®ƒä»¬ä¹Ÿå°†æ˜¾ç¤ºåœ¨é¦–é¡µä¸Šï¼

`/process_image`é¡µé¢å°†æ˜¾ç¤ºä¸Šä¼ çš„å›¾åƒä»¥åŠæ¥è‡ªWeaviateçš„ç»“æœã€‚ä¸€æ—¦æˆ‘ä»¬å°†å›¾åƒå­˜å‚¨å¹¶è½¬æ¢ä¸ºbase64æ ¼å¼ï¼Œæˆ‘ä»¬å°†å°†å…¶å‘é€åˆ°`weaviate_img_search`å‡½æ•°ä»¥è¿”å›ç»“æœå¹¶é‡æ–°æ¸²æŸ“é¡µé¢ã€‚

ä¸‹é¢çš„ä»£ç å—å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. ä»æ•°æ®é›†ä¸­å¡«å……ä¸»é¡µçš„å›¾åƒã€‚
2. ä¿å­˜ä¸Šä¼ çš„å›¾åƒå¹¶å°†å…¶è½¬æ¢ä¸ºbase64æ ¼å¼ã€‚
3. è¿”å›æ¥è‡ªWeaviateçš„`nearImage`ç»“æœï¼ŒåŒ…æ‹¬æ–‡ä»¶è·¯å¾„å’Œå“ç§ã€‚

```python
@app.route("/") # defining the pages that will be on the website
   def home(): # home page
       return render_template("index.html", content = list_images())

   @app.route("/process_image", methods = ["POST"]) # save the uploaded image and convert it to base64
   # process the image upload request by converting it to base64 and querying Weaviate
   def process_image():
           uploaded_file = Image.open(request.files['filepath'].stream)
           buffer = BytesIO()
           uploaded_file.save(buffer, format="JPEG")
           img_str = base64.b64encode(buffer.getvalue()).decode()

           weaviate_results = weaviate_img_search(img_str)
           print(weaviate_results)

           results = []
           for result in weaviate_results:
               results.append({
                   "path": result["filepath"],
                   "breed": result["breed"]
               })

           print(f"\n {results} \n")
           return render_template("index.html", content = results, dog_image = img_str)
```

æˆ‘ä»¬çš„`index.html`æ¨¡æ¿å·²ç»è®¾ç½®å¥½ï¼Œå¯ä»¥æ˜¾ç¤ºè¿”å›çš„ç‹—å“ç§çš„å›¾ç‰‡ã€‚

```html
{ % for x in content % }
<div class="imgCard">
    <img src = "./static/img/" + x["path"] > </img>
    <h4> {{x["breed"]}} </h4>
</div>
{ % endfor % }
```

æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼š
```python
if __name__ == "__main__":
   app.run()
```

ç°åœ¨æ‚¨å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ­¤æ–‡ä»¶ï¼š

```bash
python flask-app/application.py
```
å¦‚æœæ‚¨å¯¼èˆªåˆ°127.0.0.1ï¼Œæ‚¨å°†çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„Webåº”ç”¨ç¨‹åºã€‚

è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸ªæŸ¥è¯¢ï¼Œçœ‹çœ‹å“ªç§ç‹—æœ€åƒGoldendoodleå°ç‹—ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å°ç‹—ä¸æˆ‘ä»¬æ•°æ®åº“ä¸­çš„Goldendoodleå’ŒGolden Retrieverç›¸ä¼¼ã€‚

<img
    src={require('./img/results.jpg').default}
    alt="ç»“æœ"
    style={{ maxWidth: "70%" }}
/>

å°±è¿™æ ·ï¼Œæ‚¨å·²ç»æ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºï¼ç”¨æˆ·å¯ä»¥åŠ è½½ä»–ä»¬æœ€å–œæ¬¢çš„ç‹—çš„å›¾ç‰‡ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹æœ€æ¥è¿‘çš„å“ç§ï¼

## æ¦‚è¿°
åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†å¦‚ä½•ï¼š
1. åˆ›å»ºå¹¶ä¸Šä¼ æ•°æ®æ¨¡å¼
2. ä½¿ç”¨Flaskå°†Weaviateæ¼”ç¤ºè¿æ¥åˆ°Webåº”ç”¨ç¨‹åº
3. åœ¨Weaviateä¸­ä½¿ç”¨nearImageè¿ç®—ç¬¦

è™½ç„¶è¿™ä¸ªä¾‹å­ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå°æ•°æ®é›†ï¼Œä½†æ˜¯Weaviateå¯ä»¥åœ¨å¤§è§„æ¨¡çš„æ•°æ®é›†å’Œç”Ÿäº§ç¯å¢ƒä¸­æ”¯æŒè¿™æ ·çš„å›¾åƒæœç´¢ã€‚æˆ‘ä»¬ç›¸ä¿¡æ‚¨ä¼šå¯¹å…¶é€Ÿåº¦å’Œå¿«é€Ÿæ„å»ºåŸºäºå›¾åƒæ•°æ®é›†çš„å¼ºå¤§æœç´¢åŠŸèƒ½æ„Ÿåˆ°å°è±¡æ·±åˆ»ã€‚å½“æ‚¨ä½¿ç”¨æ—¶ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„ä½¿ç”¨ä½“éªŒï¼æˆ‘ä»¬éå¸¸ä¹æ„å¬å–æ¥è‡ªæˆ‘ä»¬ä¼Ÿå¤§ç¤¾åŒºä¸­çš„ç”¨æˆ·çš„å£°éŸ³ã€‚

æ„Ÿè°¢é˜…è¯»ï¼Œå¸Œæœ›å¾ˆå¿«å†è§ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨GitHubä¸ŠæŸ¥çœ‹å…¶ä»–ä¼˜ç§€çš„[Weaviateæ¼”ç¤º](https://github.com/weaviate/weaviate-examples)ï¼

import WhatNext from '/_includes/what-next.mdx'

<WhatNext />