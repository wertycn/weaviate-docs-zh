---
authors:
- zain
date: 2022-12-6
description: Learn how to import and query the Sphere dataset in Weaviate!
image: ./img/hero.png
slug: sphere-dataset-in-weaviate
tags:
- how-to
title: The Sphere Dataset in Weaviate
---

![Weaviateä¸­çš„Sphereæ•°æ®é›†](./img/hero.png)

<!-- æˆªæ–­ -->

## ä»€ä¹ˆæ˜¯Sphereï¼Ÿ
[Sphere](https://github.com/facebookresearch/sphere) æ˜¯ç”± Meta æœ€è¿‘å‘å¸ƒçš„ä¸€ä¸ªå¼€æºæ•°æ®é›†ã€‚å®ƒåŒ…å«äº†1.34äº¿ä¸ªæ–‡æ¡£ï¼ˆåˆ†æˆäº†9.06äº¿ä¸ª100ä¸ªå•è¯çš„ç‰‡æ®µï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„çŸ¥è¯†åº“ï¼Œå¯ä»¥å¸®åŠ©è§£å†³çŸ¥è¯†å¯†é›†å‹çš„è‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼Œå¦‚é—®ç­”ã€äº‹å®æ ¸æŸ¥ç­‰ã€‚æ‚¨å¯ä»¥é€šè¿‡[è¿™é‡Œ](https://ai.facebook.com/blog/introducing-sphere-meta-ais-web-scale-corpus-for-better-knowledge-intensive-nlp/)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

ç®€è€Œè¨€ä¹‹ï¼ŒSphereæ—¨åœ¨æˆä¸ºä¸€ä¸ª"é€šç”¨ã€éç­›é€‰å’Œéç»“æ„åŒ–çš„çŸ¥è¯†æ¥æº"ã€‚è¿™æ„å‘³ç€ä¸‹æ¬¡å½“ä½ æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ï¼š"éº¦å½“åŠ³è¿™ä¸ªè¿é”é¤å…æ˜¯ç”±é‚£ä¸ªå…»å†œåœºçš„è€éº¦å½“åŠ³åˆ›å»ºçš„å—ï¼Ÿ" Sphereå°†ä¼šæœ‰ç›¸å…³çš„çŸ¥è¯†æ¥å›ç­”ä½ çš„é—®é¢˜ï¼Œå¹¶æŒ‡å‘ä¸€ä¸ªç›¸å…³çš„æ–‡ç« ã€‚è¿™ä¸ªåºå¤§çš„æ•°æ®é›†çš„æ½œåŠ›ä»¤äººæƒŠå¹ï¼Œäººä»¬å¯ä»¥æ— é™åœ°è®¾æƒ³å„ç§åº”ç”¨ - ä»åœ¨ç¤¾äº¤åª’ä½“å¹³å°ä¸Šæ‰“å‡»å‡æ–°é—»ï¼Œåˆ°å¸®åŠ©æ‰¾åˆ°ä½ ä¸‹ä¸€ä¸ªæ¢¦æƒ³çš„åº¦å‡èƒœåœ°ã€‚

å¦å¤–ï¼ŒSphereéå¸¸é€‚åˆå¤§è§„æ¨¡çš„æ··åˆå‘é‡æœç´¢ï¼Œå› ä¸ºå®ƒæ˜¯å°‘æ•°å‡ ä¸ªæä¾›å‘é‡åŠå…¶å¯¹åº”æ–‡æœ¬å­—æ®µçš„å¤§è§„æ¨¡æ•°æ®é›†ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://huggingface.co/facebook/dpr-question_encoder-single-nq-base)äº†è§£ç”¨äºç”Ÿæˆè¿™äº›å‘é‡çš„æ¨¡å‹ã€‚å‡ºäºè¿™äº›åŸå› ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½è®©è¿™ä¸ªèµ„æºå¯¹ç¤¾åŒºæ›´åŠ å¯è®¿é—®ã€‚

## ä½¿ç”¨Sphereçš„æŒ‘æˆ˜

è¿™ä¸ªæ•°æ®é›†çš„å”¯ä¸€é™åˆ¶æ˜¯å¯¹äºæ™®é€šå¼€å‘è€…æ¥è¯´ï¼Œè·å–å’Œä½¿ç”¨èµ·æ¥éå¸¸å›°éš¾ã€‚åœ¨è¿™æ–¹é¢ï¼Œæ•°æ®é›†çš„åºå¤§è§„æ¨¡æˆä¸ºäº†ä¸€æŠŠåŒåˆƒå‰‘ã€‚å¯¹äºé™¤äº†å¤§å‹å·¥ä¸šå’Œå­¦æœ¯å®éªŒå®¤ä¹‹å¤–çš„ä»»ä½•äººæ¥è¯´ï¼Œä½¿ç”¨Sphereçš„å½“å‰å¼€æºæ ¼å¼éƒ½å…·æœ‰æŒ‘æˆ˜æ€§ - å³ä½¿å¯¹äºå®ƒä»¬æ¥è¯´ï¼Œç”¨æˆ·ä½“éªŒè¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ã€‚

*ä¸ç›¸ä¿¡æˆ‘å—ï¼Ÿ*

è¯·å°è¯•æŒ‰ç…§ [readme](https://github.com/facebookresearch/sphere) çš„æŒ‡ç¤ºï¼Œåœ¨æ‚¨çš„æœºå™¨ä¸Šè®¾ç½®å¹¶ä½¿ç”¨ Sphereã€‚æ‚¨å°†é¦–å…ˆé¢ä¸´çš„é™åˆ¶æ˜¯ï¼Œæœ€å°çš„å¼€æºç¨€ç– Sphere ç´¢å¼•æ–‡ä»¶åœ¨å‹ç¼©æ ¼å¼ä¸‹è¾¾åˆ°äº†æƒŠäººçš„ 833GBã€‚ä¸€æ—¦æ‚¨è·¨è¿‡äº†è¿™ä¸ªéšœç¢ï¼Œä¸ºäº†å¼€å§‹ä½¿ç”¨ Sphere æ•°æ®é›†æ¥è¿›è¡Œæ··åˆæœç´¢æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•ï¼Œè¿˜éœ€è¦ä»˜å‡ºå¦ä¸€ç•ªè‰°å·¨çš„åŠªåŠ›ã€‚

## Weaviate ä¸­çš„ Sphere æ•°æ®é›†
ä¸ºäº†ä½¿è¿™ä¸€å¼ºå¤§èµ„æºèƒ½å¤Ÿä¸ºæ¯ä¸ªäººæ‰€ç”¨ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒï¼ŒSphereç°åœ¨ä¸ä»…å¯ä»¥åœ¨Weaviateä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä»¥ä½œä¸ºJSONæˆ–Parquetæ–‡ä»¶æä¾›ã€‚å¯ä»¥ä½¿ç”¨Pythonå’ŒSparkè½»æ¾å¯¼å…¥æ•°æ®é›†ï¼æ‚¨å¯ä»¥å¯¼å…¥Sphereçš„å¤§å‹çŸ¢é‡åŒ–å—ï¼ˆæˆ–è€…æ•´ä¸ªæ•°æ®é›†ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼ï¼‰ï¼Œå¹¶åªéœ€å‡ è¡Œä»£ç å³å¯å¼€å§‹æœç´¢ï¼

å¤ªé˜³çš„åŠ›é‡å°½åœ¨æ‚¨çš„æ‰‹ä¸­ï¼*éšä¹‹è€Œæ¥çš„æ˜¯é‚ªæ¶çš„ç‹‚ç¬‘å£°*

import sphereVideo from './img/joke2.mp4';

<video width="100%" autoplay loop controls>
  <source src={sphereVideo} type="video/mp4" />
Your browser does not support the video tag.
</video>


æ˜ç™½äº†å—ï¼Ÿ...è¿™æ˜¯ä¸€ä¸ªçƒä½“ğŸ¥å’šå’šå’šğŸ¥æˆ‘ä¼šè‡ªå·±èµ°å¼€çš„...

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†Sphereæ•°æ®é›†å¯¼å…¥åˆ°Weaviateä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Pythonå®¢æˆ·ç«¯ï¼ˆå°‘äº75è¡Œä»£ç ï¼‰æˆ–Weaviate Sparkè¿æ¥å™¨ã€‚

### ä½¿ç”¨Pythonå¯¼å…¥Sphereæ•°æ®é›†
å®‰è£…éå¸¸ç®€å•ï¼Œæ‚¨åªéœ€è¦[Weaviateå®¢æˆ·ç«¯](/developers/weaviate/client-libraries)ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä½¿ç”¨Pythonå®¢æˆ·ç«¯å’Œdpr-question_encoder-single-nq-baseæ¨¡å‹çš„ç¤ºä¾‹ï¼ˆå³ç”¨äºåœ¨Sphereä¸­å¯¹å¯¹è±¡è¿›è¡Œå‘é‡åŒ–çš„æ¨¡å—ï¼‰ã€‚

æˆ‘ä»¬å‡†å¤‡äº†ä»100Kæ•°æ®ç‚¹åˆ°å®Œæ•´çš„Sphereæ•°æ®é›†ï¼ˆåŒ…å«899äº¿è¡Œï¼‰çš„æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä»è¿™é‡Œä¸‹è½½å®ƒä»¬ï¼š
* [100kè¡Œ](https://storage.googleapis.com/sphere-demo/sphere.100k.jsonl.tar.gz)
* [1Mè¡Œ](https://storage.googleapis.com/sphere-demo/sphere.1M.jsonl.tar.gz)
* [10Mè¡Œ](https://storage.googleapis.com/sphere-demo/sphere.10M.jsonl.tar.gz)
* [100Mè¡Œ](https://storage.googleapis.com/sphere-demo/sphere.100M.jsonl.tar.gz)
* [899Mè¡Œ](https://storage.googleapis.com/sphere-demo/sphere.899M.jsonl.tar.gz)

ä¸€æ—¦æ‚¨ä¸‹è½½å’Œè§£å‹ç¼©äº†æ•°æ®é›†æ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨Pythonå°†æ•°æ®é›†å¯¼å…¥Weaviateã€‚

```python
import sys
import os
import time
import json
import weaviate

# Variables
WEAVIATE_URL    = 'https://loadtest.weaviate.network/'
BATCH_SIZE      = 100
SPHERE_DATASET  = 'sphere.100k.jsonl' # update to match your filename

client = weaviate.Client(
    url=WEAVIATE_URL,
    timeout_config=600
)

client.batch.configure(
    batch_size=BATCH_SIZE,
    dynamic=True,
    num_workers=os.cpu_count()
)

# Set DPR model used for the Page class
client.schema.create_class({
    "class": "Page",
    "vectorizer": "text2vec-huggingface",
    "moduleConfig": {
        "passageModel": "sentence-transformers/facebook-dpr-ctx_encoder-single-nq-base",
        "queryModel": "sentence-transformers/facebook-dpr-question_encoder-single-nq-base",
        "options": {
            "waitForModel": True,
            "useGPU": True,
            "useCache": True
        }
    },
    "properties": []
})

# Import the data, Weaviate will use the auto-schema function to
# create the other properties and other default settings.
start = time.time()
c = 0
with open(SPHERE_DATASET) as jsonl_file:
    with client.batch as batch:
        for jsonl in jsonl_file:
            json_parsed = json.loads(jsonl)
            batch.add_data_object({
                    'url':  json_parsed['url'],
                    'title': json_parsed['title'],
                    'raw': json_parsed['raw'],
                    'sha': json_parsed['sha']
                },
                'Page',
                json_parsed['id'],
                vector=json_parsed['vector']
            )
            c += 1
            if (c % (BATCH_SIZE * 10)) == 0:
                print('Imported', c)

end = time.time()
print('Done in', end - start)
```
*ç¡®ä¿å°†SPHERE_DATASETå±æ€§æ›´æ–°ä¸ºæ­£ç¡®åŒ¹é…æ‚¨çš„`.jsonl`æ–‡ä»¶åã€‚*

### ä½¿ç”¨Sparkå¯¼å…¥Sphere
å¦‚æœæ‚¨æƒ³åœ¨Sphereä¸Šå¼€å§‹è®­ç»ƒç”¨äºçŸ¥è¯†å¯†é›†å‹ä»»åŠ¡çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›åˆ©ç”¨å¤§æ•°æ®æ¡†æ¶ã€‚è¿™å°±æ˜¯Apache Sparkçš„ç”¨æ­¦ä¹‹åœ°ï¼

è¦ä½¿ç”¨Sparkå¤„ç†Sphereï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[PySpark](https://spark.apache.org/docs/latest/api/python/)å’Œ[Weaviateçš„Pythonå®¢æˆ·ç«¯](/developers/weaviate/client-libraries/python)ã€‚è®¾ç½®è¿‡ç¨‹ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä¸ä»…ä»…æ˜¯ç®€å•åœ°ä½¿ç”¨Pythonå¯¼å…¥æ•°æ®é›†ï¼›ç„¶è€Œï¼Œä¸€æ—¦è®¾ç½®å®Œæˆï¼Œå®ƒçš„é€Ÿåº¦éå¸¸å¿«ï¼âš¡

æ‚¨å¯ä»¥åœ¨è¿™ä¸ª[tutorial](/developers/weaviate/tutorials/spark-connector)ä¸­çœ‹åˆ°è¯¦ç»†çš„ä¸€æ­¥ä¸€æ­¥çš„è¯´æ˜ã€‚è¿™ä¸ªæ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•å°†Sphereå¯¼å…¥åˆ°Spark dataframeä¸­ï¼Œç„¶åå°†å…¶å¯¼å…¥åˆ°Weaviateï¼Œå¹¶è¿›è¡ŒæŸ¥è¯¢ã€‚ä¸€æ—¦æ‚¨å°†Sphereå¯¼å…¥åˆ°æ‚¨çš„Sparkå®ä¾‹ä¸­ï¼Œæ‚¨å°±å¯ä»¥åˆ©ç”¨Sparkçš„åŠŸèƒ½æ¥å¼€å§‹è®­ç»ƒå¼ºå¤§çš„æ¨¡å‹ã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†[Weaviate Sparkè¿æ¥å™¨](https://github.com/weaviate/weaviate-spark-connector)ï¼Œä½¿ä»SparkåŠ è½½æ•°æ®åˆ°Weaviateå˜å¾—éå¸¸å®¹æ˜“ã€‚

æˆ‘ä»¬è¿˜å‡†å¤‡äº†ä¸¤ä¸ªParquetæ–‡ä»¶ï¼Œä¸€ä¸ªåŒ…å«1ç™¾ä¸‡ä¸ªæ•°æ®ç‚¹ï¼Œå¦ä¸€ä¸ªåŒ…å«æ•´ä¸ªSphereæ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«8.99äº¿è¡Œã€‚æ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å°†å®ƒä»¬ä¸‹è½½åˆ°æ•°æ®æ¡†ä¸­ï¼š

```
df = spark.read.parquet("gs://sphere-demo/parquet/sphere.1M.parquet")
df = spark.read.parquet("gs://sphere-demo/parquet/sphere.899M.parquet")
```
## ä½¿ç”¨ Weaviate åœ¨ Sphere ä¸­è¿›è¡Œæœç´¢
ç°åœ¨ï¼ŒæŒ‡ä»¤å·²ç»å®Œæˆäº†ï¼Œè®©æˆ‘ä»¬æ¥ç©ä¸€ä¸‹ï¼Œå±•ç¤ºä¸€ä¸‹ Weaviate åœ¨ Sphere ä¸Šçš„ç»¼åˆèƒ½åŠ›ï¼æˆ‘ä»¬å°†æ•´ä¸ª Sphere æ•°æ®é›†å¯¼å…¥åˆ°äº† Weaviate ä¸­ - æ˜¯çš„ï¼Œæ‰€æœ‰çº¦ 8.99 äº¿ä¸ªå¯¹è±¡ï¼Œä¸‹é¢æ˜¯è¯æ®ï¼

![å¯¼å…¥è¯æ˜](./img/image4.png)

ä¸€æ—¦ Sphere æ•°æ®é›†åœ¨ Weaviate ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ Weaviate æä¾›çš„æ‰€æœ‰åŠŸèƒ½ä¸€èµ·ä½¿ç”¨å®ƒã€‚

ç”±äºSphereçš„ä¸»è¦ç”¨é€”æ˜¯è¿›è¡Œå¤§è§„æ¨¡æ··åˆæœç´¢ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬åˆ©ç”¨å‘é‡æœç´¢æ¥æ‰¾å‡ºSphereè®¤ä¸ºæ„å¤§åˆ©æœ€å¥½åƒçš„é£Ÿç‰©ï¼ŒåŒæ—¶ä½¿ç”¨ä¼ ç»Ÿçš„è¯åŒ¹é…æ¥ç¡®ä¿è¿”å›çš„å¯¹è±¡æ¥è‡ªå¯é çš„æ¥æºï¼Œæœ¬ä¾‹ä¸­æ˜¯çº½çº¦æ—¶æŠ¥ã€‚

![æŸ¥è¯¢](./img/image1.png)

è¿™å°±æ˜¯å…¨éƒ¨å†…å®¹ï¼ç°åœ¨ï¼Œæœ‰äº†Sphereæ•°æ®é›†ï¼Œå¯ä»¥è½»æ¾å¯¼å…¥åˆ°Weaviateä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¼€å§‹åˆ©ç”¨è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç»“åˆæˆ‘ä»¬åœ¨Weaviateä¸­å·²ç»æä¾›çš„è®¸å¤šä»¤äººæƒŠå–œçš„åŠŸèƒ½æ¥æ„å»ºã€‚ç¥æ‚¨ç¼–ç æ„‰å¿«ï¼

import StayConnected from '/_includes/stay-connected.mdx'

<StayConnected />